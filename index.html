<!doctype html>
<html oncontextmenu="return false;">
	<head>
		<title id = "titile">unknown LA</title>
		<meta name="author" content="93951230">
		<meta name="description" content="useless game">
		<meta name="keywords" content="qazwsxedc9395">
		<style>
			canvas
			{
				cursor: crosshair;
				position: absolute;
				top: 0%;
				left: 0%;
			}
		</style>
	</head>
    <body>
        <noscript>
            <bold>
                enable JavaScript or begone.
            </bold>
        </noscript>
        <img id="dirt_1" style="display: none;" src="resource/block/dirt_1.png" />
        <img id="dirt_2" style="display: none;" src="resource/block/dirt_2.png" />
        <img id="rock" style="display: none;" src="resource/block/rock.png" />
        <img id="grass" style="display: none;" src="resource/block/grass.png">
        <img id="normal_tree" style="display: none;" src="resource/block/normal_tree.png">
		<!--BLOCK-->
        <img id="startImg" style="display: none;" src="resource/gui/start.png">
        <img id="background" style="display: none;" src="resource/gui/background.png">
		<img id="itembar" style="display: none;" src="resource/gui/itembar.png" />
		<img id="itembar_2" style="display: none;" src="resource/gui/itembar_2.png" />
		<img id="itembarin" style="display: none;" src="resource/gui/itembar_in.png" />
		<img id="inButton" style="display: none;" src="resource/gui/in_button.png" />
		<img id="inButtonOpen" style="display: none;" src="resource/gui/in_button_open.png" />
		<!--GUI-->
		<img id="character" style="display: none;" src="resource/entity/character.png" />
        <!--ENTITY-->
		<img id="dirt_1_drop" style="display: none;" src="resource/item/dirt_1_drop.png" />
		<img id="dirt_2_drop" style="display: none;" src="resource/item/dirt_2_drop.png" />
		<img id="grass_drop" style="display: none;" src="resource/item/grass_drop.png" />
		<img id="normal_tree_drop" style="display: none;" src="resource/item/normal_tree_drop.png" />
		<img id="iron_pickaxe" style="display: none;" src="resource/item/iron_pickaxe.png" />
		<!--ITEM-->
        <canvas id="Canvas" width="1366" height="768" />
        <script id= "otherScript">
            var randomNumber = Math.random();
			var canvas = document.getElementById("Canvas");
            var ctx = canvas.getContext("2d");
            if (randomNumber <= 0.1) {
                document.getElementById("titile").innerHTML = "93951230's trash";
            }
            else if ((randomNumber > 0.1) && (randomNumber <= 0.2)) {
                document.getElementById("titile").innerHTML = "Terrarin: China";
            }
            else if ((randomNumber > 0.3) && (randomNumber <= 0.4)) {
                document.getElementById("titile").innerHTML = "minecraft 2.0";
            }
            else if ((randomNumber > 0.5) && (randomNumber <= 0.6)) {
                document.getElementById("titile").innerHTML = "毛澤東";
            }
            else if ((randomNumber > 0.7) && (randomNumber <= 0.8)) {
                document.getElementById("titile").innerHTML = "7% :(";
            }
            else {
                document.getElementById("titile").innerHTML = "( ͡◉ ͜ʖ ͡◉)";
            }

            delete randomNumber;
        </script>
        <script src="scripts/variable.js"></script>
        <script src="scripts/blocks.js"></script>
        <script src="scripts/world_generate.js"></script>
        <script src ="scripts/entity.js"></script>
        <script id = "logicScript">
            ////////////////////////////
            //     method calling     //
            ////////////////////////////
			var itemLibrary = {
				"dirt":{
					"Light":true,
					"Collide":true,
					"Breakable":true,
					"item":itemdirt,
					"breakFull":20,
					"type":1
				},
				"rock":{
					"Light":true,
					"Collide":true,
					"Breakable":true,
					"item":itemrock,
					"breakFull":7,
					"type":2
				},
				"grass":{
					"Light":true,
					"Collide":true,
					"Breakable":true,
					"item":itemgrass,
					"breakFull":12,
					"type":1
				},
				"normal_tree":{
					"Light":false,
					"Collide":false,
					"Breakable":true,
					"item":itemnormal_tree,
					"breakFull":35,
					"method":function (x,y) {
						if (tiles[y][x+1].fill.constructor.name == "air") {
							tiles[y][x] = new tile(air, x, y);
						}
					},
					"type":0
				},
				"air":{
					"Light":false,
					"Collide":false,
					"Breakable":false
				}
			};
			var blockLibrary = {
				"itemrock":{
					
				},
				"itemdirt":{
					
				},
				"itemgrass":{
					
				},
				"itemnormal_tree":{
				},
				"itemiron_pickaxe":{
					
				}
			};
            function breakBlockDete(e, getHurt, command) {
                let Xcondition = ((e.clientX > (getHurt.x - (usualLen / 2)) + XdrawVar) && (e.clientX < (getHurt.x + (usualLen / 2)) + XdrawVar));
                let Ycondition = ((e.clientY > (getHurt.y - (usualLen / 2)) + YdrawVar) && (e.clientY < (getHurt.y + (usualLen / 2)) + YdrawVar));
                if ((Xcondition) && (Ycondition)) {
                    eval(command);
                }
            }
			function placeBlockDete(e, getHurt, target) {
                let Xcondition = ((e.clientX > (getHurt.x - (usualLen / 2)) + XdrawVar) && (e.clientX < (getHurt.x + (usualLen / 2)) + XdrawVar));
                let Ycondition = ((e.clientY > (getHurt.y - (usualLen / 2)) + YdrawVar) && (e.clientY < (getHurt.y + (usualLen / 2)) + YdrawVar));
                if ((Xcondition) && (Ycondition)) {
					if (getHurt.constructor.name != "air") {
						getHurt.breakTime -= 1;
					}
                    else {
						if (((tiles[getHurt.countY - 1][getHurt.countX].fill.constructor.name != "air") || (tiles[getHurt.countY + 1][getHurt.countX].fill.constructor.name != "air")) || ((tiles[getHurt.countY][getHurt.countX-1].fill.constructor.name != "air") || (tiles[getHurt.countY][getHurt.countX +1].fill.constructor.name != "air"))) {
							tiles[getHurt.countY][getHurt.countX] = new tile(eval(String(target.constructor.name).replace(/item/,"")),getHurt.countX,getHurt.countY);
							target.count -= 1;
						}
					}
                }
            }
			function buttonCir(e,getHurt,command) {
				let Xcondition = ((e.clientX > (getHurt.x - (getHurt.width / 2))) && (e.clientX < (getHurt.x + (getHurt.width / 2))));
                let Ycondition = ((e.clientY > (getHurt.y - (getHurt.height / 2))) && (e.clientY < (getHurt.y + (getHurt.height / 2))));
				if ((Xcondition) && (Ycondition)) {
                    eval(command);
                }
			}
            function collide(object, getHurt) {
                let Xcondition = ((object.x + (object.width / 2) > (getHurt.x - (usualLen / 2) +4) + XdrawVar) && (object.x - (object.width / 2) < (getHurt.x + (usualLen / 2)-4) + XdrawVar));
                let lessXcondition = ((object.x + (object.width / 2) > (getHurt.x - (usualLen / 2) - 4) + XdrawVar) && (object.x - (object.width / 2) < (getHurt.x + (usualLen / 2) + 4) + XdrawVar));
                let Ycondition = ((object.y + (object.height / 2) > (getHurt.y - (usualLen / 2)+4) + YdrawVar) && (object.y - (object.height / 2) < (getHurt.y + (usualLen / 2)-4) + YdrawVar));
                let lessYcondition = ((object.y + (object.height / 2) > (getHurt.y - (usualLen / 2) - 4) + YdrawVar) && (object.y - (object.height / 2) < (getHurt.y + (usualLen / 2) + 4) + YdrawVar));
                if (!((lessXcondition) || (lessYcondition))) {
                    getHurt.collideVar = null;
                }
                if (lessXcondition) {
                    getHurt.collideVar -= 1;
                }
                else if (lessYcondition) {
                    getHurt.collideVar += 1;
                }
                if ((lessXcondition) && (lessYcondition)) {
					
					try {
						object.collideO = getHurt;
						if (getHurt.collideVar < 0) {
							object.getYcollide();
						}
						else if ((Xcondition) && (!(Ycondition))) {
							if (getHurt.collideVar > 0) {
								object.getXcollide();
							}
						}
					}
					finally {
						object.getcollide();
						getHurt.collideVar = null;
					}
                }
            }
            //////
            function keyDownHandler(e) {
                keyPressed[e.code] = true;
				if (keyPressed["KeyE"]) {
					openIn = !(openIn);
				}
            }
            function keyUpHandler(e) {
                keyPressed[e.code] = false;
            }
            function mouse(e) {
                if (e.buttons == 1) {
                    if (started) {//pyramid of doom test
						if (!(itembar[selectedBar].hold == null)) {
							if (itembar[selectedBar].hold.type["type"] == 1) {
								for (i = (Math.round(CamX) - 3); i <= (Math.round(CamX) + 3); i++) {
									for (j = (Math.floor(CamY - 2)); j <= (Math.floor(CamY + 4)); j++) {
										if ((tiles[i])[-j].fill.constructor.name != "air") {
											breakBlockDete(e, (tiles[i])[-j].fill, "getHurt.breakTime -= search;".replace(/search/m,itembar[selectedBar].hold.type["speed"]));
										}
									}
								}
							}
							else if (itembar[selectedBar].hold.type["type"] == 0) {
								for (i = (Math.round(CamX) - 3); i <= (Math.round(CamX) + 3); i++) {
									for (j = (Math.floor(CamY - 2)); j <= (Math.floor(CamY + 4)); j++) {
										placeBlockDete(e, (tiles[i])[-j].fill,itembar[selectedBar].hold);
									}
								}
							}
						}
						for (i = 0;i < buttons.length;i++) {
							buttonCir(e,buttons[i],String(eval("buttons["+ i +"].command")))
						}
                    }
                    else {
                        let Xcondition = ((e.clientX > (startButton.x - (300 / 2))) && (e.clientX < (startButton.x + (300 / 2))));
                        let Ycondition = ((e.clientY > (startButton.y - (50 / 2))) && (e.clientY < (startButton.y + (50 / 2))));
                        if ((Xcondition) && (Ycondition)) {
                            /////////////////////////////////////////////////////////////////////////////////////////start
                            character.x = (canvas.width / 2);
                            character.y = (canvas.height / 2);
                            offset_X = Math.floor((canvas.width / 2) / 45);
                            offset_Y = Math.floor((canvas.height / 2) / 45);
                            generateWorld.main();
                            ctx.font = "30px monospace";
							buttons[buttons.length] = new publicButton([imgs["Gui"][4],imgs["Gui"][5]],420,32,18,45,"openIn = !openIn","if (openIn) { ctx.drawImage(this.drawImg[0], this.x-(this.width/2), this.y-(this.height/2));} else {ctx.drawImage(this.drawImg[1], this.x-(this.width/2), this.y-(this.height/2));}");
                            started = true;
                        }
                    }
                }
            }
            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);
            document.addEventListener("mousedown", mouse, false);
			//document.addEventListener("mousemove", mouseMove, false);
			function drawFont() {
				ctx.fillStyle = "White";
                ctx.fillText("Made by 80102 Weirdo :/", 10, canvas.height - 10);
				ctx.fillText("x : " + String(Math.floor(CamX * 100) / 100), 10, canvas.height - 40);
				ctx.fillText("y : " + String(Math.floor(CamY * 100) / 100), 10, canvas.height - 70);
				ctx.fillText("time of the game : " + String(character.Time), 10, canvas.height - 100);
				ctx.fillStyle = "Black";
            }
			function before() {
				ctx.font = "20px monospace";
				ctx.fillStyle = "Black";
                ctx.fillText("When the start button being click", 20, 30);
                ctx.fillText("the height and width of the game will be fix", 20, 60);
                ctx.fillText("\"如果當的話就調小視窗:)\" - developer", 20, 90);
				ctx.fillText("j of now : "+String(progress), 20, 120)
			}
        </script>
        <script id="lastScript">
            function rendering() {
                if (started) {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage((imgs["Gui"])[0], 0, 0);
					///////////////////////////////////////////////////////////////
					///////////////////////////////////////////////////////////////
                    for (i = (Math.floor(CamX) - 15 - Math.floor(canvas.width / 80)); i <= (Math.floor(CamX) + 15 + Math.floor(canvas.width / 80)); i++) {
                        for (j = (Math.floor(CamY) - 14 - Math.floor(canvas.height / 50)); j <= (Math.floor(CamY) + 14 + Math.floor(canvas.height / 50)); j++) {
                            try {
                                (tiles[i])[-j].fill.draw();
                                if (itemLibrary[tiles[i][-j].fill.constructor.name]["Collide"]) {
                                    collide(character, (tiles[i])[-j].fill);
                                }
                            }
                            catch (Error) { }
                        }
                    } //update tiles that u can see on screen;canvas.height
                    for (i = (Math.floor(CamX) - 15 - Math.floor(canvas.width / 80)); i <= (Math.floor(CamX) + 15 + Math.floor(canvas.width / 80)); i++) {
                        for (j = (Math.floor(CamY) - 18 - Math.floor(canvas.height / 50)); j <= (Math.floor(CamY) + 18 + Math.floor(canvas.height / 50)); j++) {
                            if (itemLibrary[tiles[i][-j].fill.constructor.name]["Breakable"]) {
                                breakTest((tiles[i])[-j].fill,itemLibrary[String((tiles[i])[-j].fill.ID)]);
                            }
                            if (itemLibrary[tiles[i][-j].fill.constructor.name]["Light"]) {
                                ligthTest((tiles[i])[-j].fill);
                            }
                        }
                    }
					///////////////////////////////////////////////////////////////
					///////////////////////////////////////////////////////////////
					for (i = 0; i < item.length;i++) {
						if (item[i] != null) {
							item[i].draw();
							item[i].update();
							for (j = (Math.floor(CamX) - 15 - Math.floor(canvas.width / 80)); j <= (Math.floor(CamX) + 15 + Math.floor(canvas.width / 80)); j++) {
								for (k = (Math.floor(CamY) - 14 - Math.floor(canvas.height / 50)); k <= (Math.floor(CamY) + 14 + Math.floor(canvas.height / 50)); k++) {
									collide(item[i], (tiles[j])[-k].fill);
								}
							}
						}
						else { }
					}
					ctx.font = "20px monospace";
					if (openIn) {
						for (i = 0; i < itembar_amount;i++) {
							for (j = 0; j < 3;j++) {
								itembarIn[i][j].draw();
							}
						}
					}
					ctx.font = "20px monospace";
					for (i = 0;i < buttons.length;i++) {
						buttons[i].draw();
					}
					/////////////////////////////////////////////////////////////// 
                    character.controlling();
                    character.draw();
                    character.updating();
					///////////////////////////////////////////////////////////////
					///////////////////////////////////////////////////////////////
					for (i = 0; i < itembar_amount;i++) {
						itembar[i].draw();
					}
					ctx.font = "26px monospace";
					drawFont();
                }
                else {
					canvas.height = innerHeight;
                    canvas.width = innerWidth;
                    startButton.update();
                    startButton.draw();
					ctx.font = "20px monospace";
					ctx.fillStyle = "Black";
					ctx.fillText("When the start button being click", 20, 30);
					ctx.fillText("the height and width of the game will be fix", 20, 60);
					ctx.fillText("\"如果當的話就調小視窗:)\" - developer", 20, 90);
                }
            }
            function startGame() { //start the (game)
                setInterval("rendering()", 15);
            }
            startGame();
        </script>
    </body>
</html>
