<!doctype html>
<html oncontextmenu="return false;">
	<head>
		<title id = "titile">unknown LA</title>
		<meta name="author" content="93951230">
		<meta name="description" content="useless game">
		<meta name="keywords" content="qazwsxedc9395">
		<style>
		canvas
		{
			cursor: crosshair;
			position: absolute;
			top: 0%;
			left: 0%;
		}
		</style>
	</head>
	<body onresize="canvasUpdate()">
		<noscript>
			<bold>
				enable JavaScript or begone. url("resource/blocks/rock.png")
			</bold>
		</noscript>
		<img id="dirt_1" style = "display: none;" src="resource/blocks/dirt_1.png" />
		<img id="dirt_2" style = "display: none;" src="resource/blocks/dirt_2.png" />
		<img id="rock" style = "display: none;" src="resource/blocks/rock.png" />
		<img id="grass" style = "display: none;" src="resource/blocks/normal_tree.png">
		<img id="startImg" style = "display: none;" src="resource/other/start.png">
		<img id="background" style = "display: none;" src="resource/other/background.png">
		<!--IMG-->
		<canvas id="Canvas" width="1366" height="768" />
		<script>
			var randomNumber = Math.random();
			if (randomNumber <= 0.1)
			{
				document.getElementById("titile").innerHTML = "93951230's trash";
			}
			else if ((randomNumber > 0.1) && (randomNumber <= 0.2))
			{
				document.getElementById("titile").innerHTML = "Terrarin: China";
			}
			else if ((randomNumber > 0.3) && (randomNumber <= 0.4))
			{
			    document.getElementById("titile").innerHTML = "minecraft 2.0";
			}
			else if ((randomNumber > 0.5) && (randomNumber <= 0.6))
			{
				document.getElementById("titile").innerHTML = "毛澤東";
			}
            else if ((randomNumber > 0.7) && (randomNumber <= 0.8))
            {  
                document.getElementById("titile").innerHTML = "\"吸屌\"-木木合車干";
            }
            else
			{
                document.getElementById("titile").innerHTML = "( ͡◉ ͜ʖ ͡◉)";
            }

			delete randomNumber;
			//other
			var canvas = document.getElementById("Canvas");
			var ctx = canvas.getContext("2d");
			var startButton = new function()
			{
				this.drawImg = document.getElementById("startImg");
				this.update = function()
				{
					this.x = (canvas.width/2)
					this.y = (canvas.height/2)
				}
				this.draw = function()
				{
					ctx.drawImage(this.drawImg,this.x-150,this.y-50);
				}
			}
			canvas.height = innerHeight;
			canvas.width = innerWidth;
			var started = false;
			//other
			const usualLen = 45;
			var CamX;
			var CamY;
			var XdrawVar = 0;
			var YdrawVar = 0;
			var imgs = {"Block":[],"Other":[]};
			imgs["Other"][0] = document.getElementById("background");
			imgs["Block"][0] = [];
			imgs["Block"][0][0] = document.getElementById("dirt_1");
			imgs["Block"][0][1] = document.getElementById("dirt_2");
			imgs["Block"][1] = document.getElementById("rock");
			imgs["Block"][2] = document.getElementById("grass");
			var keyPressed = {}
			var tileWi = 1600;
			var tileHi = 512;
			var tiles = [];
			function tile(filled,X,Y)
			{
				this.fill = new filled(X,Y);
			}
			function canvasUpdate()
			{
				if (!(started))
				{
					canvas.height = innerHeight;
					canvas.width = innerWidth;
				}
            }
            /////////////////////////////
            //     public function     //
            /////////////////////////////
            function ligthTest(block)
            {
                if (((tiles[block.countY-1])[block.countX].fill.light == "glow") || ((tiles[block.countY+1])[block.countX].fill.light == "glow") || ((tiles[block.countY])[block.countX-1].fill.light == "glow") || ((tiles[block.countY])[block.countX+1].fill.light == "glow"))
                {
					block.light = 4;
				}
				else
                {
                    if (Math.max((tiles[block.countY + 1])[block.countX].fill.light, (tiles[block.countY - 1])[block.countX].fill.light, (tiles[block.countY])[block.countX + 1].fill.light, (tiles[block.countY])[block.countX - 1].fill.light) != 0)
                    {
                        block.light = (Math.max((tiles[block.countY+1])[block.countX].fill.light,(tiles[block.countY-1])[block.countX].fill.light,(tiles[block.countY])[block.countX+1].fill.light,(tiles[block.countY])[block.countX-1].fill.light)-1)
                    }
				}
            }
            function breakTest(block,maxli)
            {
                if (block.breakTime <= 0)
				{
				    (tiles[block.countY])[block.countX] = new tile(air,block.countX,block.countY);
			    }
                block.breakPhase = 1 - (block.breakTime / maxli);
            }
			////////////////////
			//     blocks     //
			////////////////////
			function dirt(X,Y)
			{
				this.ID = "dirt";
				this.light = 4;
				this.countX = X;
				this.countY = Y;
				this.breakTime = 3;
				this.collideVar = null;
				this.x = 22.5+(Y*(usualLen));
				this.y = 405+(X*(usualLen));
				if (Math.random() > 0.5)
				{
					this.drawImg = imgs["Block"][0][0];
				}
				else
				{
					this.drawImg = imgs["Block"][0][1];
				}
				this.getcollide = function() {}
				this.update = function()
				{
					//breaking about
                    breakTest(this,3);
                    ligthTest(this);
				}
				this.draw = function()
				{
					ctx.drawImage(this.drawImg,(this.x-(usualLen/2))+XdrawVar,(this.y-(usualLen/2))+YdrawVar);
					ctx.globalAlpha = this.breakPhase;
					ctx.fillRect((this.x-((usualLen-((1-this.breakPhase)*usualLen)))/2)+XdrawVar,(this.y-((usualLen-((1-this.breakPhase)*usualLen))/2))+YdrawVar,usualLen-((1-this.breakPhase)*usualLen),usualLen-((1-this.breakPhase)*usualLen));
					ctx.globalAlpha = 1-(this.light/4);
					ctx.fillRect((this.x-((usualLen+1)/2))+XdrawVar,(this.y-((usualLen+1)/2))+YdrawVar,usualLen+1,usualLen+1);
					ctx.globalAlpha = 1.0;
				}
			}
			function rock(X,Y)
			{
				this.ID = "rock";
				this.light = 4;
				this.countX = X;
				this.countY = Y;
				this.breakTime = 7;
				this.collideVar = null;
				this.x = 22.5+(Y*(usualLen));
				this.y = 405+(X*(usualLen));
				this.update = function()
				{
					breakTest(this,7);
					ligthTest(this);
				}
				this.draw = function()
				{
					ctx.drawImage(imgs["Block"][1],(this.x-(usualLen/2))+XdrawVar,(this.y-(usualLen/2))+YdrawVar);
					ctx.globalAlpha = this.breakPhase;
					ctx.fillRect((this.x-((usualLen-((1-this.breakPhase)*usualLen)))/2)+XdrawVar,(this.y-((usualLen-((1-this.breakPhase)*usualLen))/2))+YdrawVar,usualLen-((1-this.breakPhase)*usualLen),usualLen-((1-this.breakPhase)*usualLen));
					ctx.globalAlpha = 1-(this.light/4);
					ctx.fillRect((this.x-((usualLen+1)/2))+XdrawVar,(this.y-((usualLen+1)/2))+YdrawVar,usualLen+1,usualLen+1);
					ctx.globalAlpha = 1.0;
				}
			}
			function grass(X,Y)
			{
				this.ID = "grass";
				this.light = 4;
				this.countX = X;
				this.countY = Y;
				this.breakTime = 2;
				this.collideVar = null;
				this.x = 22.5+(Y*(usualLen));
				this.y = 405+(X*(usualLen));
				this.update = function()
				{
					breakTest(this,2);
					ligthTest(this);
				}
				this.draw = function()
                {
                    if (this.light != 0)
                    {
                        ctx.drawImage(imgs["Block"][2], (this.x - (usualLen / 2)) + XdrawVar, (this.y - (usualLen / 2)) + YdrawVar);
                        ctx.globalAlpha = this.breakPhase;
                        ctx.fillRect((this.x - ((usualLen - ((1 - this.breakPhase) * usualLen))) / 2) + XdrawVar, (this.y - ((usualLen - ((1 - this.breakPhase) * usualLen)) / 2)) + YdrawVar, usualLen - ((1 - this.breakPhase) * usualLen), usualLen - ((1 - this.breakPhase) * usualLen));
                    }
					ctx.globalAlpha = 1-(this.light/4);
					ctx.fillRect((this.x-((usualLen+1)/2))+XdrawVar,(this.y-((usualLen+1)/2))+YdrawVar,usualLen+1,usualLen+1);
					ctx.globalAlpha = 1.0;
				}
			}
			function air(X,Y)
			{
				this.ID = "air";
				this.light = "glow";
				this.countX = X;
				this.countY = Y;
				this.breakTime = Infinity;
				this.x = 22.5+(i*(usualLen));
				this.y = 405+(j*(usualLen));
				this.update = function() {}
				this.draw = function() {}
			}
			//////////
			//blocks//
			///////////////////////////////
			function generateWorld()
			{
				let randomNumber = Math.random();
				var igenerate = [256];
                for (i = 0; i < tileWi; i++)
				{
                    if (Math.random() < 0.2) {
                        igenerate[i + 1] = igenerate[i] + 1;
                    }
                    else if ((Math.random() >= 0.2) && (Math.random() < 0.4))
					{
						igenerate[i+1] = igenerate[i]-1;
					}
					else
					{
						igenerate[i+1] = igenerate[i];
					}
				}
				for (i=0;i<tileWi;i++)
				{
					tiles[i] = [];
                    for (j = 0; j < tileHi; j++)
					{
						if (j >= igenerate[i])
						{
							// really creatin'
                            if (Math.random() > ((j-256) / 256))
							{
								(tiles[i])[j] = new tile(dirt,j,i);
							}
							else // not dirt how about rocks?
							{
								(tiles[i])[j] = new tile(rock,j,i);
							}
						}
						else
						{
							(tiles[i])[j] = new tile(air,j,i);
						}
					}
				}
				for (i=0;i<tileWi;i++)
				{
                    (tiles[i])[igenerate[i]] = new tile(grass, igenerate[i], i)
                }
                for (i=0;i<tileWi;i++)
                {

                    (tiles[i])[igenerate[i]-1] = new tile(grass, igenerate[i]-1, i)
                }
                XdrawVar = -Math.floor(45 * (tileWi / 2));
                YdrawVar = -(45 * igenerate[815])-32;
			}
			/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			var character = new function()
			{
				this.jCool = 0;
				this.ableA = 0;
				this.ableD = 0;
				this.upForce = 0;
				this.downForce = 0;
				this.height = 64;
				this.width = 32;
				this.collideVar = null;
				this.x = null;
				this.y = null;
				this.draw = function()
				{
					ctx.beginPath();
					ctx.rect(this.x-(this.width/2),this.y-(this.height/2),this.width,this.height);
					ctx.fillStyle = "#141012";
					ctx.fill();
					ctx.closePath();
				}
				this.updating = function()
				{
					CamX = -(XdrawVar/45-15);
					CamY = (YdrawVar/45-1);
					//controll about
					if (this.ableA != 0)
					{
						this.ableA -= 1;
					}
					if (this.ableD!= 0)
					{
						this.ableD -= 1;
					}
					//jumping about
					if (this.jumpTime != 0)
					{
						this.jumpTime -= 1;
					}
					if (this.jCool != 0)
					{
						this.jCool -= 1;
					}
					if (!(this.jumpTime))
					{
						if (this.downForce == 0)
						{
							this.downForce = 2;
						}
					}
					if (this.upForce != 0)
					{
						this.upForce *= 0.99;
					}
					if (this.downForce < 10)
					{
						this.downForce *= 1.02;
					}
					//falling
					YdrawVar += this.upForce-this.downForce;
				}
				this.getXcollide = function()
				{
					if (this.x>this.collideO.x+XdrawVar)
					{
						this.ableA = 10;
					}
					if (this.x<this.collideO.x+XdrawVar)
					{
						this.ableD = 10;
					}
				}
				this.getYcollide = function()
				{
					if (this.y>this.collideO.y+YdrawVar)
					{
						this.downForce = 0;
						this.upForce = 0;
						this.jumpTime = 8;
						this.jCool = 10;
					}
					else
					{
						this.downForce = 0;
						this.upForce = 0;
						this.jumpTime = 8;
						this.jumpAlready = false;
					}
				}
				this.controlling = function()
				{
                    if (keyPressed["d"])
					{
                        if (this.ableD == 0)
						{
							XdrawVar -= 3.5;
						}
					}
					if (keyPressed["a"])
					{
						if (this.ableA == 0)
						{
							XdrawVar += 3.5;
						}
					}
					if (keyPressed["s"]) {}
					if (keyPressed[" "] || keyPressed["w"])
					{
						if (((this.upForce <= 6) && (!(this.jumpAlready))) && ((this.jCool == 0) && (this.jumpTime != 0)))
						{
							this.upForce += 6;
							this.jumpAlready = true;
						}
					}
				}
			}
			/////////////////
			//key detecting//
			/////////////////
			function keyDownHandler(e) 
			{
				keyPressed[e.key] = true;
			}
			function keyUpHandler(e)
			{
				keyPressed[e.key] = false;
			}
			function mouse(e)
			{
				if (e.buttons == 1)
				{
					if (started)
					{
                        for (i = (Math.round(CamX) - 3); i <= (Math.round(CamX) + 3); i++)
						{
                            for (j = (Math.round(CamY+3) - 2); j <= (Math.round(CamY+3) + 3); j++)
							{
								try
								{
									breakBlock(e,(tiles[i])[-j].fill);
								}
                                catch (error) {}
							}
						}
					}
					else
					{
                        let Xcondition = ((e.clientX > (startButton.x - (300 / 2))) && (e.clientX < (startButton.x + (300 / 2))));
                        let Ycondition = ((e.clientY > (startButton.y - (50 / 2))) && (e.clientY < (startButton.y + (50 / 2))));
						if ((Xcondition) && (Ycondition))
						{
							/////////////////////////////////////////////////////////////////////////////////////////start
                            started = true;
                            character.x = (canvas.width / 2) + 15;
                            character.y = (canvas.height / 2) - 30;
							ctx.font = "30px monospace";
						}
					}
				}
			}
			document.addEventListener("keydown",keyDownHandler,false);
			document.addEventListener("keyup",keyUpHandler,false);
			document.addEventListener("mousedown",mouse,false);
			////////////////////////////
			//     method calling     //
			////////////////////////////
			function breakBlock(e,getHurt)
			{
				let Xcondition = ((e.clientX > (getHurt.x-(usualLen/2))+XdrawVar) && (e.clientX < (getHurt.x+(usualLen/2))+XdrawVar));
				let Ycondition = ((e.clientY > (getHurt.y-(usualLen/2))+YdrawVar) && (e.clientY < (getHurt.y+(usualLen/2))+YdrawVar));
				if ((Xcondition) && (Ycondition))
				{
					getHurt.breakTime -= 1;
				}
			}
			function collide(object,getHurt)
            {
				let Xcondition = ((object.x+(object.width/2) > (getHurt.x-(usualLen/2))+XdrawVar) && (object.x-(object.width/2) < (getHurt.x+(usualLen/2))+XdrawVar));
				let lessXcondition = ((object.x+(object.width/2) > (getHurt.x-(usualLen/2)-1)+XdrawVar) && (object.x-(object.width/2) < (getHurt.x+(usualLen/2)+1)+XdrawVar));
				let Ycondition = ((object.y+(object.height/2) > (getHurt.y-(usualLen/2))+YdrawVar) && (object.y-(object.height/2) < (getHurt.y+(usualLen/2))+YdrawVar));
				let lessYcondition = ((object.y+(object.height/2) > (getHurt.y-(usualLen/2)-1)+YdrawVar) && (object.y-(object.height/2) < (getHurt.y+(usualLen/2)+1)+YdrawVar));
				if (!((lessXcondition) || (lessYcondition)))
				{
					getHurt.collideVar = null;
				}
				if (lessXcondition)
				{
					getHurt.collideVar -= 1;
				}
				else if (lessYcondition)
				{
					getHurt.collideVar += 1;
				}
				try
				{
					if ((lessXcondition) && (lessYcondition))
					{
						object.collideO = getHurt;
						if (getHurt.collideVar < 0)
						{
							object.getYcollide();
						}
						else if (Xcondition)
						{
							if (getHurt.collideVar > 0)
							{
								object.getXcollide();
							}
						}
						object.getcollide();
						getHurt.collideVar = null;
					}
				}
				catch (Error) {}
			}
			function drawFont()
			{
				ctx.fillText("x/y = " + String(Math.round(CamX*100)/100) + " / " + String(Math.round(CamY*100)/100), 10, 40);
				ctx.fillText("Made by 80102 Weirdo :/", 10, canvas.height - 10);
			}
			/////////////////////
			function rendering() 
			{
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				if (started)
				{
					ctx.drawImage((imgs["Other"])[0],0,0);
                    for (i = (Math.round(CamX) - 15 - Math.floor(canvas.width / 80)); i <= (Math.round(CamX) + 15 + Math.floor(canvas.width / 80)); i++)
					{
                        for (j = (Math.round(CamY) - 12 - Math.floor(canvas.height / 80)); j <= (Math.round(CamY) + 12 + Math.floor(canvas.height / 80)); j++)
						{
                            try
                            {
                                (tiles[i])[-j].fill.draw();
								if ((tiles[i])[-j].fill.ID != "air")
								{
                                    collide(character, (tiles[i])[-j].fill)
								}
							}
							catch (Error) {}
						}
					} //update tiles that u can see on screen;canvas.height
                    for (i = (Math.round(CamX) - 15 - Math.floor(canvas.width / 80)); i <= (Math.round(CamX) + 15 + Math.floor(canvas.width / 80)); i++)
					{
                        for (j = (Math.round(CamY) - 12 - Math.floor(canvas.height / 80)); j <= (Math.round(CamY) + 12 + Math.floor(canvas.height / 80)); j++)
						{
							try
							{
								if ((tiles[i])[-j].fill.ID != "air")
								{
									(tiles[i])[-j].fill.update();
								}
							}
							catch (error) {}
						}
					}
					character.controlling();
					character.draw();
					character.updating();
					drawFont();
				}
				else
				{
					startButton.update();
					startButton.draw();
					ctx.font = "20px monospace";
					ctx.fillText("When the start button being click",20,30);
                    ctx.fillText("the height and width of the game will be fix", 20, 60)
                    ctx.fillText("\"如果當的話就調小視窗:)\" - developer", 20, 90)
				}
			}
			function startGame() //start the (game)
			{
				generateWorld();
				setInterval("rendering()", 15);
			}
			startGame();
		</script>
	</body>
</html>
